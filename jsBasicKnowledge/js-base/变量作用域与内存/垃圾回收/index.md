# 垃圾回收

js自动内存管理实现 内存分配 和 闲置资源回收

基本思路：确定哪个变量不再使用，然后释放它占用的内存

这个过程是周期性的，即垃圾回收每隔一定时间（或者说在代码执行过程中某个预定的收集时间）就会自动运行

垃圾回收程序必须跟踪记录哪个变量还会使用，以及哪个变量不会再使用，以便回收内存。

浏览器发展历史上用到过2种主要的标记策略：标记清理和引用计数

## 标记清理

垃圾回收程序运行的时候，会标记内存中存储的所有变量（记住，标记的方法有很多种）。
然后，它会将所有在上下文中的变量，以及被在上下文中的变量引用的变量的标记去掉。
在此之后再被加上标记的变量就是待删除的了，原因是任何在上下文中的变量都访问不到它们了。
然后垃圾回收程序做一次内存清理，销毁带标记的所有值并收回它们的内存。

缺点：（来自网络）
上图我们可以看到，红色区域是一个根对象，就是一个全局变量，会被标记；而蓝色区域就是没有被标记的对象，会被回收机制回收。这时就会出现一个问题，表面上蓝色区域被回收了三个空间，但是这三个空间是不连续的，当我们有一个需要三个空间的对象，那么我们刚刚被回收的空间是不能被分配的，这就是“空间碎片化”。

## 引用计数
思路是对每个值都记录它被引用的次数
引用数为0时，就说明没办法再访问到这个值了，可以安全的回收其内存了。
但是会遇到很严重的问题：循环引用

所谓循环引用，就是对象A有一个指针指向对象B，而对象B也引用了对象A。意味着他们的引用数都是2，函数调用结束后都不会被清理掉。






