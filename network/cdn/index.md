# cdn是什么？使用cdn有什么优势？

https://www.zhihu.com/question/36514327



C时代，浏览器对同一域名下的并发请求数是有限制的，不同浏览器不一样，一般6个左右。

为了突破该限制，一些业务就会申请多个域名，随机的拼不同的域名

# CDN工作原理

内容分发网络（Content Delivery Network，简称CDN）是建立并覆盖在承载网之上，由分布在不同区域的边缘节点服务器群组成的分布式网络。

CDN应用广泛，支持多种行业、多种场景内容加速，例如：图片小文件、大文件下载、视音频点播、直播流媒体、全站加速、安全加速。

借用阿里云官网的例子，来简单介绍CDN的工作原理。

假设通过CDN加速的域名为www.a.com，接入CDN网络，开始使用加速服务后，当终端用户（北京）发起HTTP请求时，处理流程如下：
1、当终端用户（北京）向www.a.com下的指定资源发起请求时，首先向LDNS（本地DNS）发起域名解析请求。
2、LDNS检查缓存中是否有www.a.com的IP地址记录。如果有，则直接返回给终端用户；如果没有，则向**授权DNS**查询。
3、当授权DNS解析www.a.com时，返回域名**CNAME** www.a.tbcdn.com对应IP地址。
4、域名解析请求发送至阿里云DNS调度系统，并为请求分配最佳节点IP地址。
5、LDNS获取DNS返回的解析IP地址。
6、用户获取解析IP地址。
7、用户向获取的IP地址发起对该资源的访问请求。

如果该IP地址对应的节点已缓存该资源，则会将数据直接返回给用户，例如，图中步骤7和8，请求结束。
如果该IP地址对应的节点未缓存该资源，则节点向源站发起对该资源的请求。获取资源后，结合用户自定义配置的缓存策略，将资源缓存至节点，例如，图中的北京节点，并返回给用户，请求结束。

从这个例子可以了解到：
（1）CDN的加速资源是跟域名绑定的。
（2）通过域名访问资源，首先是通过DNS分查找离用户最近的CDN节点（边缘服务器）的IP
（3）通过IP访问实际资源时，如果CDN上并没有缓存资源，则会到源站请求资源，并缓存到CDN节点上，这样，用户下一次访问时，该CDN节点就会有对应资源的缓存了。

# CDN 将请求的服务器域名解析成距离用户最近的 IP 地址具体是怎么做的呢？

关键在于三点：

1、利用 CNAME 的能力，把对 www.test.com 域名的解析变成对特定 CDN 域名的解析，例如下图中的 www.test.com.cdn.dnsv1.com
2、CDN 服务商维护着一个巨大而精确的 IP 地址数据库，能根据用户客户端的 IP 判断出客户端所在的地区、网络运营商等信息。
3、当解析 www.test.com.cdn.dnsv1.com 域名 IP 时，会向 CDN 服务的 DNS 域名发起请求（也就是下图中的第 2 步），此时 CDN 服务的 DNS 域名可以根据用户客户端的 IP 返回一个距离它最近的缓存服务器 IP



